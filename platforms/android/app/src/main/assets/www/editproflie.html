<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Bai+Jamjuree&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/sidebar.css">

    <title>SomDai</title>
</head>

<body>
    <div class="bs-example">
        <nav class="navbar bg-dark  navbar-dark fixed-top" style="background-color: rgb(10, 6, 43)">
            <!-- Toggler/collapsibe Button -->
            <a id="main" class="m-0" style="color: rgb(255, 255, 255);height: 100%;width: 50%">
                <span style="cursor:pointer" onclick="openNav()"><label class="hamburger-icon">
                        <span>&nbsp;</span>
                <span>&nbsp;</span>
                <span>&nbsp;</span>
                </label>
                </span>
            </a>

            <!-- <h4 class="text-light ">SomDai</h4> -->
            <a class="navbar-brand right" href="#">
                <img src="img/logo.png" alt="logonav" style="width: 60px;">
            </a>

        </nav>
        <div id="mySidenav" class="sidenav mt-5" onclick="closeNav()">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <div class="col-8 ">
                <img src=" img/profile.png" class="rounded-circle" alt="Cinque Terre" style="width: 100%">
            </div>
            <div class="col-16">
                <div class="card" style="width: auto">
                    <div class="card-body">
                        <h5 class="card-title" id="fname">ชื่อ-สกุล</h5>
                        <h6 class="card-subtitle mb-2 text-muted" id="position">ตำแหน่ง</h6>

                    </div>
                </div>
            </div>
            <a href="request.html">หน้าหลัก</a>
            <a href="newRequest.html">แจ้งซ่อม</a>
            <a href="report.html">รายงานการแจ้งซ่อม</a>
            <a href="editproflie.html">แก้ไขข้อมูลส่วนตัว</a>
            <a href="about.html">ทีมผู้พัฒนา</a>
            <a href="javascript:logout();">ออกจากระบบ</a>
        </div>
        <div class="container mt-5">
            <form>
                <div class="d-flex justify-content-center mt-1">
                    <div class="mt-3">
                        <img src="img/profile.png" class="brand_logo" alt="">
                    </div>
                </div>
                <div>
                    <div class="input-group mb-2 ">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                        </div>
                        <input type="text" name="" class="form-control input_user" id="email" placeholder="อีเมลล์">
                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-key"></i></span>
                        </div>
                        <input type="password" name="" class="form-control input_pass" id="password" placeholder="รหัสผ่าน">
                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-key"></i></span>
                        </div>
                        <input type="password" name="" class="form-control input_pass" id="cfpassword" placeholder="ยืนยันรหัสผ่าน">
                    </div>
                    <hr style="background-color:aliceblue;">
                    <div>
                        <a style="color: rgb(255, 255, 255);" href="#">ประวัติส่วนตัว</a>
                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                        </div>
                        <input type="text" name="" class="form-control input_user" id="firstname" placeholder="ชื่อ">
                        <input type="text" name="" class="form-control input_user" id="lastname" placeholder="สกุล">
                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                        </div>
                        <input type="text" name="" class="form-control input_user" id="nickname" placeholder="ชื่อเล่น">
                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-user-graduate"></i></span>
                        </div>
                        <select class="form-control " id="department" style="width: 87%">
                            <option>แผนก</option>
                            <option value="Sale and Marketing">Sale and Marketing</option>
                            <option value="Accounting">Accounting</option>
                            <option value="Purchased">Purchased</option>
                            <option value="Operation">Operation</option>
                            <option value="Guide">Guide</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Receptions">Receptions</option>
                            <option value="Reservation">Reservation</option>
                            <option value="Food and Beverage">Food and Beverage</option>
                            <option value="Drivers">Drivers</option>
                            <option value="Human Resources">Human Resources</option>
                        </select>

                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-address-card"></i></span>
                        </div>
                        <select class="form-control " id="position" style="width: 85%">
                            <option>ตำแหน่ง</option>
                            <option value="President(CEO)">President(CEO)</option>
                            <option value="Vice-president">Vice-president</option>
                            <option value="Managing Director">Managing Director</option>
                            <option value="General Manager(GM)">General Manager(GM)</option>
                            <option value="Manager">Manager</option>
                            <option value="Assistant Manager">Assistant Manager</option>
                            <option value="Supervisor">Supervisor</option>
                            <option value="Officer">Officer</option>
                            <option value="Technicain">Technicain</option>
                        </select>
                    </div>
                    <div class="input-group mb-2">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                        </div>
                        <input type="text" name="" class="form-control input_user" id="tel" value="" placeholder="เบอร์โทร">
                    </div>
                    <div class="d-flex justify-content-center mt-3 login_container">
                        <a name="" onclick="update()" class="btn login_btn">ยืนยัน</a>
                    </div>
                </div>
            </form>
            <div id="buttoncf"></div>

        </div>
    </div>

    <script>
        var IP = localStorage.getItem("IP");
        var ID = localStorage.getItem("ID");
        var dep = localStorage.getItem("department");;
        var e_mail;
        var password;
        var firstName;
        var lastName;
        var nickname;
        var department;
        var positions;
        var telNumber;
        if (dep === "Engineering") {
            showtechnicain()
        } else {
            show();
        }

        function show() {
            var xmlhttp = new XMLHttpRequest();
            var url = "http://" + IP + ":8443/employees/employeeID/" + ID;
            xmlhttp.open("GET", url, false);
            xmlhttp.send();
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var output = xmlhttp.responseText;
                var jsoutput = JSON.parse(output);
                e_mail = jsoutput[0].e_mail;
                password = jsoutput[0].password;
                firstName = jsoutput[0].firstName;
                lastName = jsoutput[0].lastName;
                nickname = jsoutput[0].nickname;
                department = jsoutput[0].department;
                positions = jsoutput[0].positions;
                telNumber = jsoutput[0].telNumber;

                console.log(jsoutput[0].firstName)
            }
            document.getElementById('email').value = e_mail
            document.getElementById('password').value = password
            document.getElementById('firstname').value = firstName
            document.getElementById('lastname').value = lastName
            document.getElementById('nickname').value = nickname
            document.getElementById('department').value = department
            document.getElementById('position').value = positions
            document.getElementById('tel').value = telNumber
        }

        function showtechnicain() {
            var xmlhttp = new XMLHttpRequest();
            var url = "http://" + IP + ":8443/technicains/technicainID/" + ID;
            xmlhttp.open("GET", url, false);
            xmlhttp.send();
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var output = xmlhttp.responseText;
                var jsoutput = JSON.parse(output);
                e_mail = jsoutput[0].e_mail;
                password = jsoutput[0].password;
                firstName = jsoutput[0].firstName;
                lastName = jsoutput[0].lastName;
                nickname = jsoutput[0].nickname;
                department = jsoutput[0].department;
                positions = jsoutput[0].positions;
                telNumber = jsoutput[0].telNumber;

                console.log(jsoutput[0].firstName)
            }
            document.getElementById('email').value = e_mail
            document.getElementById('password').value = password
            document.getElementById('firstname').value = firstName
            document.getElementById('lastname').value = lastName
            document.getElementById('nickname').value = nickname
            document.getElementById('department').value = department
            document.getElementById('position').value = positions
            document.getElementById('tel').value = telNumber
        }

        function update() {
            dep = localStorage.getItem("department");
            e_mail = document.getElementById("email").value;
            password = document.getElementById("password").value;
            firstName = document.getElementById("firstname").value;
            lastName = document.getElementById("lastname").value;
            nickname = document.getElementById("nickname").value;
            department = document.getElementById("department").value;
            positions = document.getElementById("position").value;
            telNumber = document.getElementById("tel").value;

            if (document.getElementById("password").value === document.getElementById("cfpassword").value) {
                var url;
                var xmlhttp = new XMLHttpRequest();
                console.log(department);

                if (department == "Engineering") {
                    url = "http://" + IP + ":8443/technicains/update/" + ID + "," + firstName + "," + lastName + "," + nickname + "," + department + "," + positions + "," + telNumber + "," + e_mail + "," + password + "," + "";

                } else {
                    url = "http://" + IP + ":8443/employees/update/" + ID + "," + firstName + "," + lastName + "," + nickname + "," + department + "," + positions + "," + telNumber + "," + e_mail + "," + password + "," + "";
                }
                console.log(url);


                xmlhttp.open("GET", url, false);
                xmlhttp.send();
                window.location.href = 'request.html';
            } else {
                document.getElementById("buttoncf").innerHTML += '<div class="alert alert-danger alert-dismissible fade show">' +
                    '<button type="button" class="close" data-dismiss="alert">&times;</button>' +
                    '<strong>รหัสผ่านไม่ตรงกัน!</strong></div>';

            }
        }
    </script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/sidebar.js"></script>
</body>

</html>