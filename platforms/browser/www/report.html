<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
        integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Bai+Jamjuree&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="css/sidebar.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

    <title>SomDai</title>
</head>

<body
    style="background-image: radial-gradient( circle farthest-corner at 1.8% 0%,  rgba(255,255,255,1) 37.6%, #bbb 90% );">
    <div class="bs-example">
    <nav class="navbar bg-dark  navbar-dark fixed-top" style="background-color: rgb(10, 6, 43)">
        <!-- Toggler/collapsibe Button -->
        <a id="main" class="m-0" style="color: rgb(255, 255, 255);height: 100%;">
            <span style="cursor:pointer" onclick="openNav()"><label class="hamburger-icon">
                    <span>&nbsp;</span>
                    <span>&nbsp;</span>
                    <span>&nbsp;</span>
                </label></span>
        </a>

        <!-- <h4 class="text-light ">SomDai</h4> -->
        <a class="navbar-brand" href="#">
            <img src="img/logo.png" alt="logonav" style="width: 60px;">
        </a>

    </nav>
    <div id="mySidenav" class="sidenav mt-5" onclick="closeNav()">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <div class="col-8 ">
            <img src=" img/profile.png" class="rounded-circle" alt="Cinque Terre" style="width: 100%">
        </div>
        <div class="col-16">
            <div class="card" style="width: auto">
                <div class="card-body">
                    <h5 class="card-title" id="fname">ชื่อ-สกุล</h5>
                    <h6 class="card-subtitle mb-2 text-muted" id="position">ตำแหน่ง</h6>

                </div>
            </div>
        </div>
        <a href="request.html">หน้าหลัก</a>
        <a href="newRequest.html">แจ้งซ่อม</a>
        <a href="report.html">รายงานการแจ้งซ่อม</a>
        <a href="javascript:logout();">ออกจากระบบ</a>
    </div>
    <div class="container ">
        <div class="form-group pt-2 ">
            <label for="exampleFormControlTextarea1">รายงานการแจ้งซ่อม</label>
            <select class="form-control " id="department" style="width: 87%">
                <option value="ทุกแผนก">ทุกแผนก</option>
                <option value="Sale and Marketing">Sale and Marketing</option>
                <option value="Accounting">Accounting</option>
                <option value="Purchased">Purchased</option>
                <option value="Operation">Operation</option>
                <option value="Guide">Guide</option>
                <option value="Engineering">Engineering</option>
                <option value="Receptions">Receptions</option>
                <option value="Reservation">Reservation</option>
                <option value="Food and Beverage">Food and Beverage</option>
                <option value="Drivers">Drivers</option>
                <option value="Human Resources">Human Resources</option>
            </select>
            <select class="form-control " id="yearShow" style="width: 87%">
            </select>
            <a name="" id="" class="btn btn-primary " onclick="finishdata()" role="button">ยืนยัน</a>
        </div>
        <canvas id="myChart"></canvas>
    </div></div>
    <script>
        var IP = localStorage.getItem("IP");
        var year = [];
        var finish = [];
        var notfinish = [];
        yearlist();
        finishdata();
        notfinishdata();
        showChart()
        function yearlist() {
            var xmlhttp = new XMLHttpRequest();
            var url = "https://" + IP + ":8443/repairing";
            xmlhttp.open("GET", url, false);
            xmlhttp.send();
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var output = xmlhttp.responseText;
                var jsoutput = JSON.parse(output);
                for (let j = 0; j < jsoutput.length; j++) {
                    var y = jsoutput[j].date.substring(0, 4);
                    year.push(y);
                }
                year = [...new Set(year)];
            }
            for (let i = 0; i < year.length; i++) {
                year.sort(function (a, b) { return b - a });
                document.getElementById('yearShow').innerHTML += '<option value="' + year[i] + '">' + year[i] + '</option>`';
            }
            console.log(year)
        }

        function finishdata() {
            finish = [];
            var year = document.getElementById('yearShow').value;
            var department = document.getElementById('department').value;
            var xmlhttp = new XMLHttpRequest();
            var url1 = "https://" + IP + ":8443/countStatusFinish";
            if (department !== 'ทุกแผนก') {
                url1 = "https://" + IP + ":8443/CountStatusFinish/deparment/" + department;
            }
            xmlhttp.open("GET", url1, false);
            console.log(url1);

            xmlhttp.send();
            console.log(xmlhttp.status);

            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var output = xmlhttp.responseText;
                var jsoutput = JSON.parse(output);
                for (let i = 0; i < jsoutput.length; i++) {
                    console.log("get " + year);
                    if (jsoutput[i].year === year) {
                        console.log(xmlhttp.status);
                        finish.push(jsoutput[i].jan);
                        finish.push(jsoutput[i].feb);
                        finish.push(jsoutput[i].mar);
                        finish.push(jsoutput[i].apr);
                        finish.push(jsoutput[i].may);
                        finish.push(jsoutput[i].jun);
                        finish.push(jsoutput[i].jul);
                        finish.push(jsoutput[i].aug);
                        finish.push(jsoutput[i].sep);
                        finish.push(jsoutput[i].oct);
                        finish.push(jsoutput[i].nov);
                        finish.push(jsoutput[i].dec);
                    }
                }
            }
            notfinishdata()
            console.log(finish)
        }

        function notfinishdata() {
            notfinish = [];
            var year = document.getElementById('yearShow').value;
            var department = document.getElementById('department').value;
            var xmlhttp = new XMLHttpRequest();
            var url1 = "https://" + IP + ":8443/CountStatusNotFinish";
            if (department !== 'ทุกแผนก') {
                url1 = "https://" + IP + ":8443/CountStatusNotFinish/deparment/" + department;
            }
            xmlhttp.open("GET", url1, false);
            console.log(url1);

            xmlhttp.send();
            console.log(xmlhttp.status);

            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var output = xmlhttp.responseText;
                var jsoutput = JSON.parse(output);
                for (let i = 0; i < jsoutput.length; i++) {
                    console.log("get " + year);
                    if (jsoutput[i].year === year) {
                        console.log(xmlhttp.status);
                        notfinish.push(jsoutput[i].jan);
                        notfinish.push(jsoutput[i].feb);
                        notfinish.push(jsoutput[i].mar);
                        notfinish.push(jsoutput[i].apr);
                        notfinish.push(jsoutput[i].may);
                        notfinish.push(jsoutput[i].jun);
                        notfinish.push(jsoutput[i].jul);
                        notfinish.push(jsoutput[i].aug);
                        notfinish.push(jsoutput[i].sep);
                        notfinish.push(jsoutput[i].oct);
                        notfinish.push(jsoutput[i].nov);
                        notfinish.push(jsoutput[i].dec);
                    }
                }
            }
            showChart()
            console.log(notfinish)
        }
        function showChart() {
            var department = document.getElementById('department').value;
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'รายการซ่อมที่เสร็จสิ้น',
                            data: [finish[0], finish[1], finish[2], finish[3], finish[4], finish[5], finish[6], finish[7], finish[8], finish[9], finish[10], finish[11]],
                            backgroundColor: '#32CCD1',
                        },
                        {
                            label: 'รายการซ่อมที่ยังไม่เสร็จสิ้น',
                            data: [notfinish[0], notfinish[1], notfinish[2], notfinish[3], notfinish[4], notfinish[5], notfinish[6], notfinish[7], notfinish[8], notfinish[9], notfinish[10], notfinish[11]],
                            backgroundColor: '#7E817C',
                        }
                    ]

                },
                options: {
                    scales: {
                        xAxes: [{ stacked: true }],
                        yAxes: [{ stacked: true }]
                    }
                }
            });

        }
    </script>

    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/sidebar.js"></script>
</body>
<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script> -->


</html>